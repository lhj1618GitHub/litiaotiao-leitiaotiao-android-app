<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GKDè‡ªå®šä¹‰è§„åˆ™ç¼–å†™è¾…åŠ©å·¥å…·</title>
    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3d3d3d;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent: #4a9cff;
            --accent-hover: #5ca8ff;
            --border: #404040;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.4;
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
            font-size: 13px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            color: var(--accent);
            margin-bottom: 8px;
            font-size: 1.8rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            body {
                padding: 10px;
                font-size: 12px;
            }
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: 6px;
            padding: 15px;
            border: 1px solid var(--border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        h2 {
            color: var(--accent);
            margin-bottom: 12px;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 8px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 3px;
            color: var(--text-primary);
            font-size: 0.85rem;
            transition: border-color 0.2s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent);
        }

        textarea {
            min-height: 60px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8rem;
            line-height: 1.3;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .checkbox-group input {
            width: auto;
        }

        .btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background-color: var(--accent-hover);
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
        }

        .btn-secondary:hover {
            background-color: #4d4d4d;
        }

        .rule-item {
            background-color: var(--bg-tertiary);
            border-radius: 3px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 2px solid var(--accent);
        }

        .rule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .rule-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .rule-actions {
            display: flex;
            gap: 4px;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 0.75rem;
        }

        .preview-section {
            grid-column: 1 / -1;
            margin-top: 15px;
        }

        .code-preview {
            background-color: #1e1e1e;
            border: 1px solid var(--border);
            border-radius: 3px;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.75rem;
            line-height: 1.2;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 12px;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .json-key {
            color: #9cdcfe;
        }

        .json-string {
            color: #ce9178;
        }

        .json-number {
            color: #b5cea8;
        }

        .json-boolean {
            color: #569cd6;
        }

        .tab-container {
            margin-bottom: 15px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 15px;
        }

        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .tab.active {
            border-bottom-color: var(--accent);
            color: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .help-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        /* Androidä¼˜åŒ–æ ·å¼ */
        @media (max-width: 480px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .card {
                padding: 10px;
            }
        }

        /* å¤åˆ¶ä¼˜åŒ– */
        .code-preview::selection {
            background-color: rgba(74, 156, 255, 0.3);
        }
        
        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 36px;
            }
            
            input, textarea, select {
                min-height: 36px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>GKDè‡ªå®šä¹‰è§„åˆ™ç¼–å†™è¾…åŠ©å·¥å…·</h1>
        <p class="subtitle">ç®€åŒ–GKDè‡ªå®šä¹‰è§„åˆ™çš„åˆ›å»ºå’Œç¼–è¾‘è¿‡ç¨‹</p>
    </header>

    <div class="tab-container">
        <div class="tabs">
            <div class="tab active" data-tab="global">å…¨å±€è§„åˆ™</div>
            <div class="tab" data-tab="local">æœ¬åœ°åº”ç”¨è§„åˆ™ç»„</div>
            <div class="tab" data-tab="single">å•è§„åˆ™</div>
        </div>

        <div class="tab-content active" id="global-tab">
            <div class="container">
                <div class="card">
                    <h2>å…¨å±€è§„åˆ™é…ç½®</h2>
                    
                    <div class="form-group">
                        <label for="global-key">Key</label>
                        <input type="number" id="global-key" value="0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="global-name">è§„åˆ™åç§°</label>
                        <input type="text" id="global-name" value="å¼€å±å¹¿å‘Š" placeholder="ä¾‹å¦‚ï¼šå¼€å±å¹¿å‘Š">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="global-fastQuery" checked>
                        <label for="global-fastQuery">å¿«é€ŸæŸ¥è¯¢ (fastQuery)</label>
                    </div>
                    
                    <div class="form-group">
                        <label for="global-matchTime">åŒ¹é…æ—¶é—´ (ms)</label>
                        <input type="number" id="global-matchTime" value="4000" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="global-actionMaximum">æœ€å¤§æ“ä½œæ¬¡æ•°</label>
                        <input type="number" id="global-actionMaximum" value="1" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="global-resetMatch">é‡ç½®åŒ¹é…æ¡ä»¶</label>
                        <select id="global-resetMatch">
                            <option value="app">app</option>
                            <option value="activity">activity</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="section-title">
                        <h2>è§„åˆ™åˆ—è¡¨</h2>
                        <button class="btn btn-small" id="add-global-rule">æ·»åŠ è§„åˆ™</button>
                    </div>
                    
                    <div id="global-rules-container">
                        <div class="rule-item">
                            <div class="rule-header">
                                <span class="rule-title">è§„åˆ™ #1</span>
                                <div class="rule-actions">
                                    <button class="btn btn-small btn-secondary remove-rule">åˆ é™¤</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Key</label>
                                <input type="number" class="rule-key" value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label>åŒ¹é…æ¡ä»¶ (matches)</label>
                                <textarea class="rule-matches">[text*="è·³è¿‡"][text.length<10][visibleToUser=true]</textarea>
                                <p class="help-text">ä½¿ç”¨CSSé€‰æ‹©å™¨è¯­æ³•å®šä¹‰åŒ¹é…æ¡ä»¶</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="local-tab">
            <div class="container">
                <div class="card">
                    <h2>åº”ç”¨è§„åˆ™ç»„é…ç½®</h2>
                    
                    <div class="form-group">
                        <label for="app-id">åº”ç”¨ID (åŒ…å)</label>
                        <input type="text" id="app-id" placeholder="ä¾‹å¦‚ï¼šcom.example.app">
                    </div>
                    
                    <div class="form-group">
                        <label for="app-name">åº”ç”¨åç§°</label>
                        <input type="text" id="app-name" placeholder="ä¾‹å¦‚ï¼šç¤ºä¾‹åº”ç”¨">
                    </div>
                    
                    <div class="form-group">
                        <label for="app-desc">åŠŸèƒ½æè¿°</label>
                        <textarea id="app-desc" placeholder="æè¿°æ­¤è§„åˆ™ç»„çš„åŠŸèƒ½"></textarea>
                    </div>
                </div>

                <div class="card">
                    <div class="section-title">
                        <h2>è§„åˆ™ç»„åˆ—è¡¨</h2>
                        <button class="btn btn-small" id="add-group">æ·»åŠ è§„åˆ™ç»„</button>
                    </div>
                    
                    <div id="groups-container">
                        <!-- è§„åˆ™ç»„å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="single-tab">
            <div class="container">
                <div class="card">
                    <h2>å•è§„åˆ™é…ç½®</h2>
                    
                    <div class="form-group">
                        <label for="single-key">Key</label>
                        <input type="number" id="single-key" value="1" min="1">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="single-fastQuery" checked>
                        <label for="single-fastQuery">å¿«é€ŸæŸ¥è¯¢ (fastQuery)</label>
                    </div>
                    
                    <div class="form-group">
                        <label for="single-activityIds">æ´»åŠ¨ç•Œé¢ (activityIds)</label>
                        <input type="text" id="single-activityIds" placeholder="ä¾‹å¦‚ï¼šcom.example.MainActivity">
                        <p class="help-text">å¯é€‰å­—æ®µï¼Œç•™ç©ºåˆ™ä¸ç”Ÿæˆæ­¤å±æ€§</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="single-matches">åŒ¹é…æ¡ä»¶ (matches)</label>
                        <textarea id="single-matches" placeholder='ä¾‹å¦‚ï¼š[text="å…³é—­"][visibleToUser=true]'></textarea>
                        <p class="help-text">ä½¿ç”¨CSSé€‰æ‹©å™¨è¯­æ³•å®šä¹‰åŒ¹é…æ¡ä»¶</p>
                    </div>
                </div>

                <div class="card">
                    <h2>è§„åˆ™é¢„è§ˆ</h2>
                    <div class="form-group">
                        <p>åœ¨æ­¤é…ç½®å•æ¡ç‹¬ç«‹è§„åˆ™ï¼Œé€‚ç”¨äºç®€å•çš„å¹¿å‘Šå±è”½æˆ–åŠŸèƒ½å¢å¼ºåœºæ™¯ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="preview-section">
        <div class="card">
            <h2>è§„åˆ™é¢„è§ˆ</h2>
            <div class="code-preview" id="code-preview">
                // é¢„è§ˆå†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ
            </div>
            <div class="actions">
                <button class="btn" id="copy-code">
                    <span>ğŸ“‹</span> å¤åˆ¶ä»£ç 
                </button>
                <button class="btn btn-secondary" id="reset-form">
                    <span>ğŸ”„</span> é‡ç½®è¡¨å•
                </button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€è§„åˆ™ç®¡ç†
        document.getElementById('add-global-rule').addEventListener('click', function() {
            addGlobalRule();
        });

        // æœ¬åœ°è§„åˆ™ç»„ç®¡ç†
        document.getElementById('add-group').addEventListener('click', function() {
            addGroup();
        });

        // æ ‡ç­¾åˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.getAttribute('data-tab') + '-tab').classList.add('active');
                
                updatePreview();
            });
        });

        // å¤åˆ¶ä»£ç  - Androidä¼˜åŒ–ç‰ˆæœ¬
        document.getElementById('copy-code').addEventListener('click', function() {
            const codePreview = document.getElementById('code-preview');
            const code = codePreview.textContent || codePreview.innerText;
            
            // åˆ›å»ºä¸´æ—¶textareaç”¨äºå¤åˆ¶
            const textArea = document.createElement('textarea');
            textArea.value = code;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            textArea.setSelectionRange(0, 99999); // ç§»åŠ¨è®¾å¤‡æ”¯æŒ
            
            try {
                const successful = document.execCommand('copy');
                const originalText = this.innerHTML;
                if (successful) {
                    this.innerHTML = '<span>âœ…</span> å·²å¤åˆ¶';
                } else {
                    this.innerHTML = '<span>âŒ</span> å¤åˆ¶å¤±è´¥';
                }
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 2000);
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                const originalText = this.innerHTML;
                this.innerHTML = '<span>âŒ</span> å¤åˆ¶å¤±è´¥';
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 2000);
            }
            
            document.body.removeChild(textArea);
        });

        // é‡ç½®è¡¨å•
        document.getElementById('reset-form').addEventListener('click', function() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è¡¨å•æ•°æ®å—ï¼Ÿ')) {
                document.getElementById('global-key').value = 0;
                document.getElementById('global-name').value = 'å¼€å±å¹¿å‘Š';
                document.getElementById('global-fastQuery').checked = true;
                document.getElementById('global-matchTime').value = 4000;
                document.getElementById('global-actionMaximum').value = 1;
                document.getElementById('global-resetMatch').value = 'app';
                
                document.getElementById('app-id').value = '';
                document.getElementById('app-name').value = '';
                document.getElementById('app-desc').value = '';
                
                document.getElementById('single-key').value = 1;
                document.getElementById('single-fastQuery').checked = true;
                document.getElementById('single-activityIds').value = '';
                document.getElementById('single-matches').value = '';
                
                // é‡ç½®è§„åˆ™å®¹å™¨
                document.getElementById('global-rules-container').innerHTML = '';
                document.getElementById('groups-container').innerHTML = '';
                
                // æ·»åŠ é»˜è®¤çš„å…¨å±€è§„åˆ™
                addGlobalRule();
                
                updatePreview();
            }
        });

        // äº‹ä»¶å§”æ‰˜å¤„ç†è§„åˆ™åˆ é™¤
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-rule')) {
                e.target.closest('.rule-item').remove();
                updatePreview();
            }
            
            if (e.target.classList.contains('remove-group')) {
                e.target.closest('.group-item').remove();
                updatePreview();
            }
            
            if (e.target.classList.contains('add-rule-to-group')) {
                const groupItem = e.target.closest('.group-item');
                addRuleToGroup(groupItem);
            }
        });

        // è¾“å…¥å˜åŒ–æ—¶æ›´æ–°é¢„è§ˆ
        document.addEventListener('input', function(e) {
            if (e.target.matches('input, textarea, select')) {
                updatePreview();
            }
        });

        document.addEventListener('change', function(e) {
            if (e.target.matches('input[type="checkbox"]')) {
                updatePreview();
            }
        });

        // æ·»åŠ å…¨å±€è§„åˆ™å‡½æ•°
        function addGlobalRule() {
            const container = document.getElementById('global-rules-container');
            const ruleCount = container.children.length + 1;
            
            const ruleHTML = `
                <div class="rule-item">
                    <div class="rule-header">
                        <span class="rule-title">è§„åˆ™ #${ruleCount}</span>
                        <div class="rule-actions">
                            <button class="btn btn-small btn-secondary remove-rule">åˆ é™¤</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Key</label>
                        <input type="number" class="rule-key" value="${ruleCount - 1}" min="0">
                    </div>
                    <div class="form-group">
                        <label>åŒ¹é…æ¡ä»¶ (matches)</label>
                        <textarea class="rule-matches">[text*="è·³è¿‡"][text.length<10][visibleToUser=true]</textarea>
                        <p class="help-text">ä½¿ç”¨CSSé€‰æ‹©å™¨è¯­æ³•å®šä¹‰åŒ¹é…æ¡ä»¶</p>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', ruleHTML);
            updatePreview();
        }

        // æ·»åŠ è§„åˆ™ç»„å‡½æ•°
        function addGroup() {
            const container = document.getElementById('groups-container');
            const groupCount = container.children.length + 1;
            
            const groupHTML = `
                <div class="group-item card" style="margin-top: 12px;">
                    <div class="section-title">
                        <h3>è§„åˆ™ç»„ #${groupCount}</h3>
                        <button class="btn btn-small btn-secondary remove-group">åˆ é™¤ç»„</button>
                    </div>
                    <div class="form-group">
                        <label>Key</label>
                        <input type="number" class="group-key" value="${groupCount}" min="1">
                    </div>
                    <div class="form-group">
                        <label>åˆ†ç±»åç§°</label>
                        <input type="text" class="group-name" placeholder="ä¾‹å¦‚ï¼šå¼¹çª—å¹¿å‘Š">
                    </div>
                    <div class="form-group">
                        <label>åŠŸèƒ½æè¿°</label>
                        <textarea class="group-desc" placeholder="æè¿°æ­¤è§„åˆ™ç»„çš„åŠŸèƒ½"></textarea>
                    </div>
                    <div class="section-title">
                        <h4>è§„åˆ™åˆ—è¡¨</h4>
                        <button class="btn btn-small add-rule-to-group">æ·»åŠ è§„åˆ™</button>
                    </div>
                    <div class="group-rules-container">
                        <!-- è§„åˆ™å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', groupHTML);
            
            // ä¸ºæ–°ç»„æ·»åŠ ä¸€ä¸ªé»˜è®¤è§„åˆ™
            const newGroup = container.lastElementChild;
            addRuleToGroup(newGroup);
            updatePreview();
        }

        // å‘è§„åˆ™ç»„æ·»åŠ è§„åˆ™
        function addRuleToGroup(groupItem) {
            const rulesContainer = groupItem.querySelector('.group-rules-container');
            const ruleCount = rulesContainer.children.length + 1;
            
            const ruleHTML = `
                <div class="rule-item" style="margin-top: 8px;">
                    <div class="rule-header">
                        <span class="rule-title">è§„åˆ™ #${ruleCount}</span>
                        <div class="rule-actions">
                            <button class="btn btn-small btn-secondary remove-rule">åˆ é™¤</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Key</label>
                        <input type="number" class="rule-key" value="${ruleCount}" min="1">
                    </div>
                    <div class="checkbox-group" style="margin-bottom: 8px;">
                        <input type="checkbox" class="rule-fastQuery" checked>
                        <label>å¿«é€ŸæŸ¥è¯¢ (fastQuery)</label>
                    </div>
                    <div class="form-group">
                        <label>æ´»åŠ¨ç•Œé¢ (activityIds)</label>
                        <input type="text" class="rule-activityIds" placeholder="ä¾‹å¦‚ï¼šcom.example.MainActivity">
                    </div>
                    <div class="form-group">
                        <label>åŒ¹é…æ¡ä»¶ (matches)</label>
                        <textarea class="rule-matches" placeholder='ä¾‹å¦‚ï¼š[text="å…³é—­"][visibleToUser=true]'></textarea>
                        <p class="help-text">ä½¿ç”¨CSSé€‰æ‹©å™¨è¯­æ³•å®šä¹‰åŒ¹é…æ¡ä»¶</p>
                    </div>
                </div>
            `;
            
            rulesContainer.insertAdjacentHTML('beforeend', ruleHTML);
            updatePreview();
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
            let previewContent = '';
            
            if (activeTab === 'global') {
                previewContent = generateGlobalRule();
            } else if (activeTab === 'local') {
                previewContent = generateLocalRule();
            } else if (activeTab === 'single') {
                previewContent = generateSingleRule();
            }
            
            document.getElementById('code-preview').innerHTML = highlightJSON5(previewContent);
        }

        // ç”Ÿæˆå…¨å±€è§„åˆ™ï¼ˆJSON5æ ¼å¼ï¼‰
        function generateGlobalRule() {
            const key = parseInt(document.getElementById('global-key').value) || 0;
            const name = document.getElementById('global-name').value || 'å¼€å±å¹¿å‘Š';
            const fastQuery = document.getElementById('global-fastQuery').checked;
            const matchTime = parseInt(document.getElementById('global-matchTime').value) || 4000;
            const actionMaximum = parseInt(document.getElementById('global-actionMaximum').value) || 1;
            const resetMatch = document.getElementById('global-resetMatch').value || 'app';
            
            // æ”¶é›†è§„åˆ™
            const rules = [];
            document.querySelectorAll('#global-rules-container .rule-item').forEach((ruleItem, index) => {
                const ruleKey = parseInt(ruleItem.querySelector('.rule-key').value) || 0;
                const matches = ruleItem.querySelector('.rule-matches').value || '';
                
                if (matches) {
                    rules.push({
                        key: ruleKey,
                        matches: matches
                    });
                }
            });
            
            if (rules.length === 0) {
                return "// è¯·æ·»åŠ è‡³å°‘ä¸€æ¡è§„åˆ™";
            }
            
            // æ‰‹åŠ¨æ„å»ºJSON5å­—ç¬¦ä¸²ï¼ˆé”®åä¸åŠ å¼•å·ï¼‰
            let json5 = '{\n';
            json5 += `  key: ${key},\n`;
            json5 += `  name: '${name.replace(/'/g, "\\'")}',\n`;
            json5 += `  fastQuery: ${fastQuery},\n`;
            json5 += `  matchTime: ${matchTime},\n`;
            json5 += `  actionMaximum: ${actionMaximum},\n`;
            json5 += `  resetMatch: '${resetMatch}',\n`;
            json5 += '  rules: [\n';
            
            rules.forEach((rule, index) => {
                json5 += '    {\n';
                json5 += `      key: ${rule.key},\n`;
                json5 += `      matches: '${rule.matches.replace(/'/g, "\\'")}',\n`;
                json5 += '    }' + (index < rules.length - 1 ? ',' : '') + '\n';
            });
            
            json5 += '  ],\n';
            json5 += '}';
            
            return json5;
        }

        // ç”Ÿæˆæœ¬åœ°åº”ç”¨è§„åˆ™ï¼ˆJSON5æ ¼å¼ï¼‰
        function generateLocalRule() {
            const id = document.getElementById('app-id').value;
            const name = document.getElementById('app-name').value || 'æœªå‘½ååº”ç”¨';
            const desc = document.getElementById('app-desc').value || '';
            
            if (!id) {
                return "// è¯·å…ˆå¡«å†™åº”ç”¨IDï¼ˆåŒ…åï¼‰";
            }
            
            // æ”¶é›†è§„åˆ™ç»„
            const groups = [];
            document.querySelectorAll('#groups-container .group-item').forEach((groupItem, groupIndex) => {
                const groupKey = parseInt(groupItem.querySelector('.group-key').value) || (groupIndex + 1);
                const groupName = groupItem.querySelector('.group-name').value || `è§„åˆ™ç»„${groupIndex + 1}`;
                const groupDesc = groupItem.querySelector('.group-desc').value || '';
                
                // æ”¶é›†ç»„å†…çš„è§„åˆ™
                const rules = [];
                groupItem.querySelectorAll('.group-rules-container .rule-item').forEach((ruleItem, ruleIndex) => {
                    const ruleKey = parseInt(ruleItem.querySelector('.rule-key').value) || (ruleIndex + 1);
                    const fastQuery = ruleItem.querySelector('.rule-fastQuery').checked;
                    const activityIds = ruleItem.querySelector('.rule-activityIds').value;
                    const matches = ruleItem.querySelector('.rule-matches').value;
                    
                    const ruleObj = {
                        key: ruleKey,
                        fastQuery: fastQuery
                    };
                    
                    if (activityIds) ruleObj.activityIds = activityIds;
                    if (matches) ruleObj.matches = matches;
                    
                    rules.push(ruleObj);
                });
                
                if (rules.length > 0) {
                    groups.push({
                        key: groupKey,
                        name: groupName,
                        desc: groupDesc,
                        rules: rules
                    });
                }
            });
            
            if (groups.length === 0) {
                return "// è¯·æ·»åŠ è‡³å°‘ä¸€ä¸ªè§„åˆ™ç»„";
            }
            
            // æ‰‹åŠ¨æ„å»ºJSON5å­—ç¬¦ä¸²ï¼ˆé”®åä¸åŠ å¼•å·ï¼‰
            let json5 = '{\n';
            json5 += `  id: '${id.replace(/'/g, "\\'")}',\n`;
            json5 += `  name: '${name.replace(/'/g, "\\'")}',\n`;
            if (desc) {
                json5 += `  desc: '${desc.replace(/'/g, "\\'")}',\n`;
            }
            json5 += '\n';
            json5 += '  groups: [\n';
            
            groups.forEach((group, groupIndex) => {
                json5 += '    {\n';
                json5 += `      key: ${group.key},\n`;
                json5 += `      name: '${group.name.replace(/'/g, "\\'")}',\n`;
                if (group.desc) {
                    json5 += `      desc: '${group.desc.replace(/'/g, "\\'")}',\n`;
                }
                json5 += '      rules: [\n';
                
                group.rules.forEach((rule, ruleIndex) => {
                    json5 += '        {\n';
                    json5 += `          key: ${rule.key},\n`;
                    json5 += `          fastQuery: ${rule.fastQuery}`;
                    
                    if (rule.activityIds) {
                        json5 += `,\n          activityIds: '${rule.activityIds.replace(/'/g, "\\'")}'`;
                    }
                    
                    if (rule.matches) {
                        json5 += `,\n          matches: '${rule.matches.replace(/'/g, "\\'")}'`;
                    }
                    
                    json5 += '\n        }' + (ruleIndex < group.rules.length - 1 ? ',' : '') + '\n';
                });
                
                json5 += '      ],\n';
                json5 += '    }' + (groupIndex < groups.length - 1 ? ',' : '') + '\n';
            });
            
            json5 += '  ],\n';
            json5 += '}';
            
            return json5;
        }

        // ç”Ÿæˆå•è§„åˆ™ï¼ˆJSON5æ ¼å¼ï¼‰
        function generateSingleRule() {
            const key = parseInt(document.getElementById('single-key').value) || 1;
            const fastQuery = document.getElementById('single-fastQuery').checked;
            const activityIds = document.getElementById('single-activityIds').value;
            const matches = document.getElementById('single-matches').value;
            
            if (!matches) {
                return "// è¯·å¡«å†™åŒ¹é…æ¡ä»¶ (matches)";
            }
            
            // æ‰‹åŠ¨æ„å»ºJSON5å­—ç¬¦ä¸²ï¼ˆé”®åä¸åŠ å¼•å·ï¼‰
            let json5 = '{\n';
            json5 += `  key: ${key},\n`;
            json5 += `  fastQuery: ${fastQuery}`;
            
            if (activityIds) {
                json5 += `,\n  activityIds: '${activityIds.replace(/'/g, "\\'")}'`;
            }
            
            if (matches) {
                json5 += `,\n  matches: '${matches.replace(/'/g, "\\'")}'`;
            }
            
            json5 += '\n}';
            
            return json5;
        }

        // JSON5è¯­æ³•é«˜äº®
        function highlightJSON5(json) {
            return json.replace(/(\w+)\s*:|(['"])(.*?)\2\s*:|(\b(true|false|null)\b)|(-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)|(['"])(.*?)\7/g, function(match, key, quote1, str1, bool, num, quote2, str2) {
                if (key) {
                    // é”®åï¼ˆä¸åŠ å¼•å·ï¼‰
                    return '<span class="json-key">' + key + '</span>:';
                } else if (quote1 && str1 !== undefined) {
                    // å­—ç¬¦ä¸²å€¼
                    return '<span class="json-string">' + quote1 + str1 + quote1 + '</span>';
                } else if (bool) {
                    // å¸ƒå°”å€¼
                    return '<span class="json-boolean">' + bool + '</span>';
                } else if (num) {
                    // æ•°å­—
                    return '<span class="json-number">' + num + '</span>';
                } else if (quote2 && str2 !== undefined) {
                    // å­—ç¬¦ä¸²å€¼ï¼ˆå¦ä¸€ç§å¼•å·ï¼‰
                    return '<span class="json-string">' + quote2 + str2 + quote2 + '</span>';
                }
                return match;
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ·»åŠ é»˜è®¤çš„å…¨å±€è§„åˆ™
            addGlobalRule();
            updatePreview();
        });
    </script>
</body>
</html>
